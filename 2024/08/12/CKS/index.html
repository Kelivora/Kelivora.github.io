<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CKS考试 | 颗粒的运维手册</title><meta name="author" content="keli"><meta name="copyright" content="keli"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1、kube-bench 修复不安全项Context针对 kubeadm 创建的 cluster 运行 CIS 基准测试工具时，发现了多个必须立即解决的问题。Task通过配置修复所有问题并重新启动受影响的组件以确保新的设置生效。修复针对 API 服务器发现的所有以下违规行为：1.2.7 Ensure that the –authorization-mode argument is not set">
<meta property="og:type" content="article">
<meta property="og:title" content="CKS考试">
<meta property="og:url" content="http://example.com/2024/08/12/CKS/index.html">
<meta property="og:site_name" content="颗粒的运维手册">
<meta property="og:description" content="1、kube-bench 修复不安全项Context针对 kubeadm 创建的 cluster 运行 CIS 基准测试工具时，发现了多个必须立即解决的问题。Task通过配置修复所有问题并重新启动受影响的组件以确保新的设置生效。修复针对 API 服务器发现的所有以下违规行为：1.2.7 Ensure that the –authorization-mode argument is not set">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/avatar.png">
<meta property="article:published_time" content="2024-08-12T02:26:27.998Z">
<meta property="article:modified_time" content="2024-04-28T06:04:34.000Z">
<meta property="article:author" content="keli">
<meta property="article:tag" content="kubernetes考试">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/avatar.png"><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="http://example.com/2024/08/12/CKS/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CKS考试',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-28 14:04:34'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="颗粒的运维手册"><span class="site-name">颗粒的运维手册</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">CKS考试</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-12T02:26:27.998Z" title="发表于 2024-08-12 10:26:27">2024-08-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-28T06:04:34.000Z" title="更新于 2024-04-28 14:04:34">2024-04-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/kubernetes/">kubernetes</a></span></div><div class="meta-secondline"></div></div></div><article class="post-content" id="article-container"><h3 id="1、kube-bench-修复不安全项"><a href="#1、kube-bench-修复不安全项" class="headerlink" title="1、kube-bench 修复不安全项"></a>1、kube-bench 修复不安全项</h3><p><strong>Context</strong><br>针对 kubeadm 创建的 cluster 运行 CIS 基准测试工具时，发现了多个必须立即解决的问题。<br><strong>Task</strong><br>通过配置修复所有问题并重新启动受影响的组件以确保新的设置生效。<br>修复针对 API 服务器发现的所有以下违规行为：<br>1.2.7 Ensure that the <strong>–authorization-mode</strong> argument is not set to <strong>AlwaysAllow</strong> FAIL<br>1.2.8 Ensure that the <strong>–authorization-mode</strong> argument includes <strong>Node</strong> FAIL<br>1.2.9 Ensure that the <strong>–authorization-mode</strong> argument includes <strong>RBAC</strong> FAIL<br>1.2.18 Ensure that the <strong>–insecure-bind-address</strong> argument is <strong>not set</strong> FAIL （v1.28 考题中这项没给出，但最好也检查一下，模拟环境是里需要改的）<br>修复针对 kubelet 发现的所有以下违规行为：<br>Fix all of the following violations that were found against the <strong>kubelet</strong>:<br>4.2.1 Ensure that the <strong>anonymous-auth</strong> argument is set to <strong>false</strong> FAIL<br>4.2.2 Ensure that the <strong>–authorization-mode</strong> argument is not set to <strong>AlwaysAllow</strong> FAIL<br>注意：尽可能使用 Webhook 身份验证&#x2F;授权。<br>修复针对 etcd 发现的所有以下违规行为：<br>Fix all of the following violations that were found against <strong>etcd</strong>:<br>2.2 Ensure that the <strong>–client-cert-auth</strong> argument is set to <strong>true</strong> FAIL<br>模拟环境里，初始化这道题的脚本为 kube-bench.sh</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh master01</span><br><span class="line">candidate@master01:~$ sudo -i</span><br><span class="line">root@master01:~$ sh kube-bench.sh //模拟这道题的初始环境</span><br><span class="line">root@master01:~$ mkdir bak1</span><br><span class="line">root@master01:~$ cp /etc/kubernetes/manifests/kube-apiserver.yaml bak1/</span><br><span class="line">root@master01:~$ cp /etc/kubernetes/manifests/etcd.yaml bak1/</span><br><span class="line">root@master01:~$ cp /var/lib/kubelet/config.yaml bak1/</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line"> - --authorization-mode=Node,RBAC</span><br><span class="line">#删除 insecure-bind-address。实际考试中，有可能本来就没写这行。</span><br><span class="line"> - --insecure-bind-address=0.0.0.0</span><br><span class="line"></span><br><span class="line">root@master01:~$ vim /var/lib/kubelet/config.yaml</span><br><span class="line"># anonymous 应该为 false，webhook 应该为 true。</span><br><span class="line"> anonymous: </span><br><span class="line"> enabled: false #将 true 改为 false</span><br><span class="line"> webhook:</span><br><span class="line"> enabled: true #修改为 true。</span><br><span class="line"></span><br><span class="line">authorization: #修改 authorization 下的</span><br><span class="line"> mode: Webhook #改为 Webhook</span><br><span class="line"></span><br><span class="line">root@master01:~$ vim /etc/kubernetes/manifests/etcd.yaml</span><br><span class="line"> - --client-cert-auth=true #修改为 true</span><br><span class="line"></span><br><span class="line">root@master01:~$ systemctl daemon-reload</span><br><span class="line">root@master01:~$ systemctl restart kubelet</span><br><span class="line">root@master01:~$ kubectl get pod -A # 确保所有的 pod 都是 Running</span><br><span class="line">exit,exit</span><br></pre></td></tr></table></figure>
<h3 id="2、Pod-指定-ServiceAccount"><a href="#2、Pod-指定-ServiceAccount" class="headerlink" title="2、Pod 指定 ServiceAccount"></a>2、Pod 指定 ServiceAccount</h3><p><strong>Context</strong><br>您组织的安全策略包括：<br>ServiceAccount 不得自动挂载 API 凭据<br>ServiceAccount 名称必须以“-sa”结尾<br>清单文件 <strong>&#x2F;cks&#x2F;sa&#x2F;pod1.yaml</strong> 中指定的 Pod 由于 ServiceAccount 指定错误而无法调度。<br>请完成一下项目：<br><strong>Task</strong><br>在现有 namespace <strong>qa</strong> 中创建一个名为 <strong>backend-sa</strong> 的新 ServiceAccount，确保此 ServiceAccount 不自动挂载 API 凭据。<br>使用 <strong>&#x2F;cks&#x2F;sa&#x2F;pod1.yaml</strong> 中的清单文件来创建一个 Pod。<br>最后，清理 namespace <strong>qa</strong> 中任何未使用的 ServiceAccount。</p>
<h5 id="1-创建-ServiceAccount"><a href="#1-创建-ServiceAccount" class="headerlink" title="1 创建 ServiceAccount"></a>1 创建 ServiceAccount</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">## 搜sa 全称configure-service-account</span><br><span class="line">candidate@node01:~$ vim qa-ns.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line"> name: backend-sa #修改 name</span><br><span class="line"> namespace: qa #注意添加 namespace</span><br><span class="line">automountServiceAccountToken: false #修改为 false，表示不自动挂载 secret</span><br><span class="line">candidate@node01:~$ kubectl apply -f qa-ns.yaml</span><br><span class="line">candidate@node01:~$ kubectl get sa -n qa</span><br><span class="line">NAME         SECRETS   AGE</span><br><span class="line">backend-sa   0         58s</span><br></pre></td></tr></table></figure>
<h5 id="2-创建-Pod-使用该-ServiceAccount"><a href="#2-创建-Pod-使用该-ServiceAccount" class="headerlink" title="2 创建 Pod 使用该 ServiceAccount"></a>2 创建 Pod 使用该 ServiceAccount</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ vi /cks/sa/pod1.yaml</span><br><span class="line">……</span><br><span class="line">metadata:</span><br><span class="line"> name: backend</span><br><span class="line"> namespace: qa #注意命名空间是否对</span><br><span class="line">spec:</span><br><span class="line"> serviceAccountName: backend-sa # 没有则添加一行，有则修改这一行</span><br><span class="line"> containers:</span><br><span class="line">……</span><br><span class="line">candidate@node01:~$ kubectl apply -f /cks/sa/pod1.yaml</span><br><span class="line">candidate@node01:~$ kubectl get pod -n qa</span><br><span class="line">NAME      READY   STATUS    RESTARTS      AGE</span><br><span class="line">backend   1/1     Running   0             8s</span><br></pre></td></tr></table></figure>
<h5 id="3-删除没有使用的-ServiceAccount"><a href="#3-删除没有使用的-ServiceAccount" class="headerlink" title="3 删除没有使用的 ServiceAccount"></a>3 删除没有使用的 ServiceAccount</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有 sa，下图可以看到一共有 3 个 sa。</span><br><span class="line">candidate@node01:~$ kubectl get sa -n qa</span><br><span class="line"># 查看已经在用的 sa，可以看到 default 和 backend-sa 都已经使用了。</span><br><span class="line">candidate@node01:~$ kubectl get pod -n qa -o yaml | grep -i serviceAccountName</span><br><span class="line"># 删除不用的 sa</span><br><span class="line">candidate@node01:~$ kubectl delete sa test01 -n qa</span><br></pre></td></tr></table></figure>
<h3 id="3、默认网络策略"><a href="#3、默认网络策略" class="headerlink" title="3、默认网络策略"></a>3、默认网络策略</h3><p><strong>Context</strong><br>一个默认拒绝（default-deny）的 NetworkPolicy 可避免在未定义任何其他 NetworkPolicy 的 namespace 中意外公开 Pod。<br><strong>Task</strong><br>为所有类型为 <strong>Ingress+Egress</strong> 的流量在 namespace <strong>testing</strong> 中创建一个名为 <strong>denypolicy</strong> 的新默认拒绝 NetworkPolicy。 此新的 NetworkPolicy 必须拒绝 namespace <strong>testing</strong> 中的所有的 <strong>Ingress + Egress</strong> 流量。 将新创建的默认拒绝 NetworkPolicy 应用与在 namespace <strong>testing</strong> 中运行的所有 Pod。<br>你可以在 <strong>&#x2F;cks&#x2F;net&#x2F;p1.yaml</strong> 找到一个模板清单文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">## 搜networkpolicy</span><br><span class="line">candidate@node01:~$ vi /cks/net/p1.yaml</span><br><span class="line">apiVersion: networking.k8s.io/v1</span><br><span class="line">kind: NetworkPolicy</span><br><span class="line">metadata:</span><br><span class="line"> name: denypolicy #修改 name</span><br><span class="line"> namespace: testing #注意添加 namespace</span><br><span class="line">spec:</span><br><span class="line"> podSelector: &#123;&#125;</span><br><span class="line"> policyTypes:</span><br><span class="line"> - Ingress</span><br><span class="line"> - Egress #根据题目要求保留</span><br><span class="line">candidate@node01:~$ kubectl apply -f /cks/net/p1.yaml</span><br><span class="line">candidate@node01:~$ kubectl describe networkpolicy denypolicy -n testing</span><br></pre></td></tr></table></figure>
<h3 id="4、RBAC-RoleBinding"><a href="#4、RBAC-RoleBinding" class="headerlink" title="4、RBAC - RoleBinding"></a>4、RBAC - RoleBinding</h3><p><strong>Context</strong><br>绑定到 Pod 的 ServiceAccount 的 Role 授予过度宽松的权限。完成以下项目以减少权限集。<br><strong>Task</strong><br>一个名为 <strong>web-pod</strong> 的现有 Pod 已在 namespace <strong>db</strong> 中运行。<br>编辑绑定到 Pod 的 ServiceAccount <strong>service-account-web</strong> 的现有 Role，仅允许只对 <strong>services</strong> 类型的资源执行 <strong>get</strong> 操作。 在 namespace <strong>db</strong> 中创建一个名为 <strong>role-2</strong> ，并仅允许只对 <strong>namespaces</strong> 类型的资源执行 <strong>delete</strong> 操作的新 Role。 创建一个名为 <strong>role-2-binding</strong> 的新 RoleBinding，将新创建的 Role 绑定到 Pod 的 ServiceAccount。<br>注意：请勿删除现有的 RoleBinding。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">## 搜RBAC</span><br><span class="line">candidate@node01:~$ kubectl describe rolebindings -n db</span><br><span class="line">candidate@node01:~$ kubectl edit role role-1 -n db</span><br><span class="line">……</span><br><span class="line">rules: #模拟环境里要删除掉 null，然后添加以下内容。考试时，要根据实际情况修改。</span><br><span class="line">- apiGroups: [&quot;&quot;] </span><br><span class="line"> resources: [&quot;services&quot;] </span><br><span class="line">#对 services 资源 get 操作权限。还可能会考对 endpoints 资源 list 的操作权限，或对 namespace 的 update 权限。</span><br><span class="line"> verbs: [&quot;get&quot;] </span><br><span class="line">#这里也是要根据题目实际的要求写，比如题目要求 watch 权限，则这里就将 get 改成 watch。</span><br><span class="line">candidate@node01:~$ kubectl create role -h</span><br><span class="line">candidate@node01:~$ kubectl create role role-2 --verb=delete --resource=namespaces -n db</span><br><span class="line">## 记住 --verb 是权限，可能考 delete 或者 update 等 --resource 是对象，可能考 namespaces 或者 persistentvolumeclaims 等。</span><br><span class="line">candidate@node01:~$ kubectl create rolebinding -h</span><br><span class="line">candidate@node01:~$ kubectl create rolebinding role-2-binding --role=role-2 --serviceaccount=db:service-account-web -n db</span><br><span class="line">candidate@node01:~$ kubectl describe rolebindings -n db</span><br><span class="line">candidate@node01:~$ kubectl describe role -n db</span><br></pre></td></tr></table></figure>
<h3 id="5、日志审计-log-audit"><a href="#5、日志审计-log-audit" class="headerlink" title="5、日志审计 log audit"></a>5、日志审计 log audit</h3><p><strong>Task</strong><br>在 cluster 中启用审计日志。为此，请启用日志后端，并确保： </p>
<ul>
<li>日志存储在 <strong>&#x2F;var&#x2F;log&#x2F;kubernetes&#x2F;audit-logs.txt</strong></li>
<li>日志文件能保留 <strong>10</strong> 天 </li>
<li>最多保留 <strong>2</strong> 个旧审计日志文件</li>
</ul>
<p><strong>&#x2F;etc&#x2F;kubernetes&#x2F;logpolicy&#x2F;sample-policy.yaml</strong> 提供了基本策略。它仅指定不记录的内容。<br>注意：基本策略位于 cluster 的 master 节点上。<br>编辑和扩展基本策略以记录： </p>
<ul>
<li>RequestResponse 级别的 <strong>persistentvolumes</strong> 更改 </li>
<li>namespace <strong>front-apps</strong> 中 <strong>configmaps</strong> 更改的请求体 </li>
<li><strong>Metadata</strong> 级别的所有 namespace 中的 ConfigMap 和 Secret 的更改</li>
</ul>
<p>此外，添加一个全方位的规则以在 <strong>Metadata</strong> 级别记录所有其他请求。<br>注意：不要忘记应用修改后的策略。<br>模拟环境里，初始化这道题的脚本为 log-audit.sh</p>
<h5 id="配置审计策略"><a href="#配置审计策略" class="headerlink" title="配置审计策略"></a>配置审计策略</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh master01</span><br><span class="line">candidate@master01:~$ sudo -i</span><br><span class="line">root@master01:~$ sh log-audit.sh</span><br><span class="line">root@master01:~$ cp /etc/kubernetes/logpolicy/sample-policy.yaml bak1/</span><br><span class="line">root@master01:~$ vim /etc/kubernetes/logpolicy/sample-policy.yaml</span><br><span class="line"># 搜audit</span><br><span class="line">rules:</span><br><span class="line"> # namespaces changes at RequestResponse level</span><br><span class="line"> - level: RequestResponse</span><br><span class="line"> resources:</span><br><span class="line"> - group: &quot;&quot;</span><br><span class="line"> resources: [&quot;persistentvolumes&quot;] #根据题目要求修改，比如题目要求的是 namespaces。</span><br><span class="line"> #the request body of persistentvolumes/pods changes in the namespace front-apps</span><br><span class="line"> - level: Request</span><br><span class="line"> resources:</span><br><span class="line"> - group: &quot;&quot;</span><br><span class="line"> resources: [&quot;configmaps&quot;] #根据题目要求修改，比如题目要求的是 persistentvolumes 或者 pods。</span><br><span class="line"> namespaces: [&quot;front-apps&quot;]</span><br><span class="line"> - level: Metadata</span><br><span class="line"> resources:</span><br><span class="line"> - group: &quot;&quot;</span><br><span class="line"> resources: [&quot;secrets&quot;, &quot;configmaps&quot;]</span><br><span class="line"> # Also, add a catch-all rule to log all other requests at the Metadata level.</span><br><span class="line"> - level: Metadata</span><br><span class="line"> omitStages:</span><br><span class="line"> - &quot;RequestReceived&quot;</span><br></pre></td></tr></table></figure>
<h5 id="配置-master-节点的-kube-apiserver-yaml"><a href="#配置-master-节点的-kube-apiserver-yaml" class="headerlink" title="配置 master 节点的 kube-apiserver.yaml"></a>配置 master 节点的 kube-apiserver.yaml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ cp /etc/kubernetes/manifests/kube-apiserver.yaml /bak1</span><br><span class="line">root@master01:~$ vi /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">#定义审计策略 yaml 文件位置，通过 hostpath 挂载</span><br><span class="line"> - --audit-policy-file=/etc/kubernetes/logpolicy/sample-policy.yaml</span><br><span class="line">#定义审计日志位置，通过 hostpath 挂载</span><br><span class="line"> - --audit-log-path=/var/log/kubernetes/audit-logs.txt </span><br><span class="line">#定义保留旧审计日志文件的最大天数为 10 天</span><br><span class="line"> - --audit-log-maxage=10</span><br><span class="line">#定义要保留的审计日志文件的最大数量为 2 个</span><br><span class="line"> - --audit-log-maxbackup=2</span><br><span class="line">root@master01:~$ systemctl daemon-reload</span><br><span class="line">root@master01:~$ systemctl restart kubelet</span><br><span class="line">root@master01:~$ kubectl get pod -A</span><br><span class="line">root@master01:~$ tail /var/log/kubernetes/audit-logs.txt</span><br><span class="line">exit,exit</span><br></pre></td></tr></table></figure>
<h3 id="6、创建-Secret"><a href="#6、创建-Secret" class="headerlink" title="6、创建 Secret"></a>6、创建 Secret</h3><p><strong>Task</strong><br>在 namespace <strong>istio-system</strong> 中获取名为 <strong>db1-test</strong> 的现有 secret 的内容<br>将 <strong>username</strong> 字段存储在名为 <strong>&#x2F;cks&#x2F;sec&#x2F;user.txt</strong> 的文件中，并将 <strong>password</strong> 字段存储在名为 <strong>&#x2F;cks&#x2F;sec&#x2F;pass.txt</strong> 的文件中。<br>注意：你必须创建以上两个文件，他们还不存在。<br>注意：不要在以下步骤中使用&#x2F;修改先前创建的文件，如果需要，可以创建新的临时文件。<br>在 <strong>istio-system</strong> namespace 中创建一个名为 <strong>db2-test</strong> 的新 secret，内容如下：<br><strong>username : production-instance</strong><br><strong>password : KvLftKgs4aVH</strong><br>最后，创建一个新的 Pod，它可以通过卷访问 <strong>secret db2-test</strong> ：<br>Pod 名称 <strong>secret-pod</strong><br>Namespace <strong>istio-system</strong><br>容器名 <strong>dev-container</strong><br>镜像 <strong>nginx</strong><br>卷名 <strong>secret-volume</strong><br>挂载路径 <strong>&#x2F;etc&#x2F;secret</strong></p>
<h5 id="1-将-db1-test-的-username-和-password，通过-base64-解码保存到题目指定文件："><a href="#1-将-db1-test-的-username-和-password，通过-base64-解码保存到题目指定文件：" class="headerlink" title="1 将 db1-test 的 username 和 password，通过 base64 解码保存到题目指定文件："></a>1 将 db1-test 的 username 和 password，通过 base64 解码保存到题目指定文件：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ kubectl get secrets db1-test -n istio-system -o yaml</span><br><span class="line">candidate@node01:~$ echo &#x27;ZGIx&#x27;|base64 -d &gt; /cks/sec/user.txt</span><br><span class="line">candidate@node01:~$ echo &#x27;aGVsbG8=&#x27;|base64 -d &gt; /cks/sec/pass.txt</span><br><span class="line">candidate@node01:~$ cat /cks/sec/user.txt</span><br><span class="line">candidate@node01:~$ cat /cks/sec/pass.txt</span><br></pre></td></tr></table></figure>
<h5 id="2-创建名为-db2-test-的-secret-使用题目要求的用户名和密码作为键值。注意要加命名空间。"><a href="#2-创建名为-db2-test-的-secret-使用题目要求的用户名和密码作为键值。注意要加命名空间。" class="headerlink" title="2 创建名为 db2-test 的 secret 使用题目要求的用户名和密码作为键值。注意要加命名空间。"></a>2 创建名为 db2-test 的 secret 使用题目要求的用户名和密码作为键值。注意要加命名空间。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ kubectl create secret -h</span><br><span class="line">candidate@node01:~$ kubectl create secret generic -h</span><br><span class="line">candidate@node01:~$ kubectl create secret generic db2-test -n istio-system --from-literal=username=production-instance --from-literal=password=KvLftKgs4aVH</span><br><span class="line">candidate@node01:~$ kubectl get secret -n istio-system</span><br></pre></td></tr></table></figure>
<h5 id="3-创建-Pod-使用该-secret"><a href="#3-创建-Pod-使用该-secret" class="headerlink" title="3 创建 Pod 使用该 secret"></a>3 创建 Pod 使用该 secret</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 搜secret</span><br><span class="line">candidate@node01:~$ vim k8s-secret.yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line"> name: secret-pod #pod 名字</span><br><span class="line"> namespace: istio-system #命名空间</span><br><span class="line">spec:</span><br><span class="line"> containers:</span><br><span class="line"> - name: dev-container #容器名字</span><br><span class="line"> image: nginx #镜像名字</span><br><span class="line"> imagePullPolicy: IfNotPresent</span><br><span class="line"> volumeMounts: #挂载路径</span><br><span class="line"> - name: secret-volume #卷名</span><br><span class="line"> mountPath: /etc/secret</span><br><span class="line"> volumes:</span><br><span class="line"> - name: secret-volume #卷名</span><br><span class="line"> secret:</span><br><span class="line"> secretName: db2-test #名为 db2-test 的 secret</span><br><span class="line">candidate@node01:~$ kubectl apply -f k8s-secret.yaml</span><br><span class="line">candidate@node01:~$ kubectl get pod -n istio-system</span><br></pre></td></tr></table></figure>
<h3 id="7、Dockerfile-检测"><a href="#7、Dockerfile-检测" class="headerlink" title="7、Dockerfile 检测"></a>7、Dockerfile 检测</h3><p><strong>Task</strong><br>分析和编辑给定的 Dockerfile <strong>&#x2F;cks&#x2F;docker&#x2F;Dockerfile</strong>（基于 <strong>ubuntu:16.04</strong> 镜像），<br>并修复在文件中拥有的突出的安全&#x2F;最佳实践问题的两个指令。<br>分析和编辑给定的清单文件 <strong>&#x2F;cks&#x2F;docker&#x2F;deployment.yaml</strong> ，<br>并修复在文件中拥有突出的安全&#x2F;最佳实践问题的两个字段。<br>注意：请勿添加或删除配置设置；只需修改现有的配置设置让以上两个配置设置都不再有安全&#x2F;最佳实践问题。<br>注意：如果您需要非特权用户来执行任何项目，请使用用户 ID <strong>65535</strong> 的用户 <strong>nobody</strong> 。<br>只修改即可，不需要创建。</p>
<h5 id="1-修改-Dockerfile"><a href="#1-修改-Dockerfile" class="headerlink" title="1 修改 Dockerfile"></a>1 修改 Dockerfile</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ vi /cks/docker/Dockerfile</span><br><span class="line">1、修改基础镜像为题目要求的 ubuntu:16.04</span><br><span class="line">FROM ubuntu:16.04</span><br><span class="line">2、仅将 CMD 上面的 USER root 修改为 USER nobody，不需要改其他的 USER root。</span><br><span class="line">USER nobody</span><br></pre></td></tr></table></figure>
<h5 id="2-修改-deployment-yaml"><a href="#2-修改-deployment-yaml" class="headerlink" title="2 修改 deployment.yaml"></a>2 修改 deployment.yaml</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ vi /cks/docker/deployment.yaml</span><br><span class="line">1、需要将原先的 run: couchdb 修改为 app: couchdb</span><br><span class="line"> app: couchdb</span><br><span class="line">2、确保 &#x27;privileged&#x27;: 为 False ，确保&#x27;readonlyRootFilesystem&#x27;: 为 True，确保&#x27;runAsUser&#x27;: 为 65535</span><br><span class="line">securityContext:</span><br><span class="line"> &#123;&#x27;capabilities&#x27;: &#123;&#x27;add&#x27;: [&#x27;NET_BIND_SERVICE&#x27;], &#x27;drop&#x27;: [&#x27;all&#x27;]&#125;, &#x27;privileged&#x27;: False, &#x27;readOnlyRootFilesystem&#x27;: True, &#x27;runAsUser&#x27;: 65535&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8、沙箱运行容器-gVisor"><a href="#8、沙箱运行容器-gVisor" class="headerlink" title="8、沙箱运行容器 gVisor"></a>8、沙箱运行容器 gVisor</h3><p><strong>Context</strong><br>该 cluster 使用 <strong>containerd</strong> 作为 CRI 运行时。<strong>containerd</strong> 的默认运行时处理程序是 <strong>runc</strong>。<br><strong>containerd</strong> 已准备好支持额外的运行时处理程序 <strong>runsc</strong> (gVisor)。<br><strong>Task</strong><br>使用名为 <strong>runsc</strong> 的现有运行时处理程序，创建一个名为 <strong>untrusted</strong> 的 RuntimeClass。<br>更新 namespace <strong>server</strong> 中的所有 Pod 以在 gVisor 上运行。<br>您可以在 <strong>&#x2F;cks&#x2F;gVisor&#x2F;rc.yaml</strong> 中找到一个模版清单。</p>
<h5 id="1-创建-RuntimeClass"><a href="#1-创建-RuntimeClass" class="headerlink" title="1 创建 RuntimeClass"></a>1 创建 RuntimeClass</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 搜 runtimeclass</span><br><span class="line">candidate@node01:~$ vi /cks/gVisor/rc.yaml</span><br><span class="line">apiVersion: node.k8s.io/v1</span><br><span class="line">kind: RuntimeClass</span><br><span class="line">metadata:</span><br><span class="line"> name: untrusted # 用来引用 RuntimeClass 的名字</span><br><span class="line">handler: runsc # 对应的 CRI 配置的名称</span><br><span class="line">candidate@node01:~$ kubectl create -f /cks/gVisor/rc.yaml</span><br><span class="line">candidate@node01:~$ kubectl get RuntimeClass</span><br></pre></td></tr></table></figure>
<h5 id="2-将命名空间为-server-下的-Pod-引用-RuntimeClass"><a href="#2-将命名空间为-server-下的-Pod-引用-RuntimeClass" class="headerlink" title="2 将命名空间为 server 下的 Pod 引用 RuntimeClass"></a>2 将命名空间为 server 下的 Pod 引用 RuntimeClass</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ kubectl -n server get deployment</span><br><span class="line">candidate@node01:~$ kubectl -n server edit deployments busybox-run</span><br><span class="line">candidate@node01:~$ kubectl -n server edit deployments nginx-host</span><br><span class="line">candidate@node01:~$ kubectl -n server edit deployments run-test</span><br><span class="line">spec: #找到这个 spec，注意在 deployment 里是有两个单独行的 spec 的，要找第二个，也就是下面有 containers 这个字段的 spec。</span><br><span class="line"> runtimeClassName: untrusted #添加这一行，注意空格对齐</span><br><span class="line"> containers:</span><br><span class="line">candidate@node01:~$ kubectl -n server get pod</span><br></pre></td></tr></table></figure>
<h3 id="9、网络策略-NetworkPolicy"><a href="#9、网络策略-NetworkPolicy" class="headerlink" title="9、网络策略 NetworkPolicy"></a>9、网络策略 NetworkPolicy</h3><p><strong>Task</strong><br>创建一个名为 <strong>pod-restriction</strong> 的 NetworkPolicy 来限制对在 namespace <strong>dev-team</strong> 中运行的 Pod <strong>products-service</strong> 的访问。<br>只允许以下 Pod 连接到 Pod <strong>products-service</strong></p>
<ul>
<li>namespace <strong>qaqa</strong> 中的 Pod </li>
<li>位于任何 namespace，带有标签 <strong>environment: testing</strong> 的 Pod</li>
</ul>
<p>注意：确保应用 NetworkPolicy。<br>你可以在**&#x2F;cks&#x2F;net&#x2F;po.yaml** 找到一个模板清单文件。</p>
<h5 id="1-检查-namespace-标签"><a href="#1-检查-namespace-标签" class="headerlink" title="1 检查 namespace 标签"></a>1 检查 namespace 标签</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看 qaqa 命名空间标签（name: qaqa）</span><br><span class="line">candidate@node01:~$ kubectl get ns --show-labels</span><br><span class="line"># 查看 pod 标签（environment: testing）</span><br><span class="line">candidate@node01:~$ kubectl get pod -n dev-team --show-labels</span><br><span class="line"># 如果 Pod 或者 Namespace 没有标签，则需要打上标签。</span><br><span class="line">candidate@node01:~$ kubectl label ns qaqa name=qaqa</span><br><span class="line">candidate@node01:~$ kubectl label pod products-service environment=testing -n dev-team</span><br></pre></td></tr></table></figure>
<h5 id="2-创建-NetworkPolicy"><a href="#2-创建-NetworkPolicy" class="headerlink" title="2 创建 NetworkPolicy"></a>2 创建 NetworkPolicy</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ vi /cks/net/po.yaml</span><br><span class="line"># 查networkpolicy，根据官网，修改为如下内容：</span><br><span class="line">……</span><br><span class="line">metadata:</span><br><span class="line">  name: pod-restriction #修改</span><br><span class="line">  namespace: dev-team #修改</span><br><span class="line">spec:</span><br><span class="line">  podSelector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      environment: testing</span><br><span class="line">  policyTypes:</span><br><span class="line">    - Ingress #注意，这里只写 - Ingress，不要将 - Egress 也复制进来！</span><br><span class="line">  ingress:</span><br><span class="line">    - from: #第一个 from</span><br><span class="line">        - namespaceSelector:</span><br><span class="line">            matchLabels:</span><br><span class="line">              name: qaqa #命名空间有 name: qaqa 标签的</span><br><span class="line">    - from: #第二个 from</span><br><span class="line">        - namespaceSelector: &#123;&#125; #修改为这样，所有命名空间</span><br><span class="line">          podSelector:  #注意，这个 podSelector 前面的“-” 要删除。</span><br><span class="line">            matchLabels:</span><br><span class="line">              environment: testing #有 environment: testing 标签的 Pod，这个地方是根据题目要求“Pods with label environment: testing , in any namespace”，这句话里的 pod 标签写的。不要和上面 spec 里的混淆。</span><br><span class="line">#创建</span><br><span class="line">candidate@node01:~$ kubectl apply -f /cks/net/po.yaml</span><br><span class="line">#检查</span><br><span class="line">candidate@node01:~$ kubectl describe networkpolicy -n dev-team</span><br></pre></td></tr></table></figure>
<h3 id="10、Trivy-扫描镜像安全漏洞"><a href="#10、Trivy-扫描镜像安全漏洞" class="headerlink" title="10、Trivy 扫描镜像安全漏洞"></a>10、Trivy 扫描镜像安全漏洞</h3><p><strong>Task</strong><br>使用 Trivy 开源容器扫描器检测 namespace <strong>kamino</strong> 中 Pod 使用的具有严重漏洞的镜像。<br>查找具有 <strong>High</strong> 或 <strong>Critical</strong> 严重性漏洞的镜像，并删除使用这些镜像的 Pod。<br>注意：Trivy 仅安装在 cluster 的 master 节点上，<br>在工作节点上不可使用。<br>你必须切换到 cluster 的 master 节点才能使用 Trivy。</p>
<h5 id="1-切换到-Master-的-candidate-下"><a href="#1-切换到-Master-的-candidate-下" class="headerlink" title="1 切换到 Master 的 candidate 下"></a>1 切换到 Master 的 candidate 下</h5><p>candidate@node01:~$ ssh master01</p>
<h5 id="2-获取命名空间-kamino-下的所有-pod-和其-image-的对应关系"><a href="#2-获取命名空间-kamino-下的所有-pod-和其-image-的对应关系" class="headerlink" title="2 获取命名空间 kamino 下的所有 pod 和其 image 的对应关系"></a>2 获取命名空间 kamino 下的所有 pod 和其 image 的对应关系</h5><p>kubectl get pods –namespace kamino –output&#x3D;custom-columns&#x3D;”NAME:.metadata.name,IMAGE:.spec.containers[*].image”</p>
<h5 id="3-检查镜像是否有高危和严重的漏洞"><a href="#3-检查镜像是否有高危和严重的漏洞" class="headerlink" title="3 检查镜像是否有高危和严重的漏洞"></a>3 检查镜像是否有高危和严重的漏洞</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">candidate@master01:~$ trivy image -h</span><br><span class="line">for i in &#123;amazonlinux:1,amazonlinux:2,nginx:1.19,vicuu/nginx:host&#125;; do trivy image -s &quot;HIGH,CRITICAL&quot; $i &gt;&gt; 10.txt;done</span><br></pre></td></tr></table></figure>
<h5 id="4-删除有问题的-pod"><a href="#4-删除有问题的-pod" class="headerlink" title="4 删除有问题的 pod"></a>4 删除有问题的 pod</h5><p>candidate@master01:~$ kubectl -n kamino delete pod XXXX –force<br>exit</p>
<h3 id="11、AppArmor"><a href="#11、AppArmor" class="headerlink" title="11、AppArmor"></a>11、AppArmor</h3><p><strong>Context</strong><br>APPArmor 已在 cluster 的工作节点 node02 上被启用。一个 APPArmor 配置文件已存在，但尚未被实施。<br><strong>Task</strong><br>在 cluster 的工作节点 node02 上，实施位于 <strong>&#x2F;etc&#x2F;apparmor.d&#x2F;nginx_apparmor</strong> 的现有 APPArmor 配置文件。 编辑位于 <strong>&#x2F;cks&#x2F;KSSH00401&#x2F;nginx-deploy.yaml</strong> 的现有清单文件以应用 AppArmor 配置文件。<br>最后，应用清单文件并创建其中指定的 Pod 。<br>请注意，考试时，考题里已表明 APPArmor 在工作节点上，所以你需要 ssh 到开头写的工作节点上。<br>在模拟环境，你需要 ssh 到 node02 这个工作节点。</p>
<h5 id="1-切换到-node02-的-root-下"><a href="#1-切换到-node02-的-root-下" class="headerlink" title="1 切换到 node02 的 root 下"></a>1 切换到 node02 的 root 下</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh node02</span><br><span class="line">candidate@node02:~$ sudo -i</span><br></pre></td></tr></table></figure>
<h5 id="2-切换到-apparmor-的目录"><a href="#2-切换到-apparmor-的目录" class="headerlink" title="2 切换到 apparmor 的目录"></a>2 切换到 apparmor 的目录</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@node02:~$ cd /etc/apparmor.d/</span><br><span class="line">root@node02:~$ cat nginx_apparmor</span><br></pre></td></tr></table></figure>
<h5 id="3-执行-apparmor-策略模块"><a href="#3-执行-apparmor-策略模块" class="headerlink" title="3 执行 apparmor 策略模块"></a>3 执行 apparmor 策略模块</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@node02:~$ apparmor_status #查不到，没启动</span><br><span class="line">root@node02:~$ apparmor_parser /etc/apparmor.d/nginx_apparmor #启用</span><br><span class="line">root@node02:~$ apparmor_status# 再次检查有结果了</span><br></pre></td></tr></table></figure>
<h5 id="4-修改-pod-文件"><a href="#4-修改-pod-文件" class="headerlink" title="4 修改 pod 文件"></a>4 修改 pod 文件</h5><p>注意！注意！考试时，这个文件是在默认登录的终端那个初始节点上的，而不是在这个 work 节点的。<br>exit exit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">搜apparmor</span><br><span class="line">candidate@node01:~$ vi /cks/KSSH00401/nginx-deploy.yaml</span><br><span class="line">name: podx</span><br><span class="line">annotations:</span><br><span class="line"> container.apparmor.security.beta.kubernetes.io/podx: localhost/nginx-profile-3</span><br><span class="line">candidate@node01:~$ kubectl apply -f /cks/KSSH00401/nginx-deploy.yaml</span><br><span class="line">candidate@node01:~$ kubectl get pod</span><br></pre></td></tr></table></figure>
<h3 id="12、Sysdig-falco"><a href="#12、Sysdig-falco" class="headerlink" title="12、Sysdig &amp; falco"></a>12、Sysdig &amp; falco</h3><p>Task：<br>使用运行时检测工具来检测 Pod <strong>redis123</strong> 单个容器中频发生成和执行的异常进程。<br>有两种工具可供使用： </p>
<ul>
<li><strong>sysdig</strong></li>
<li><strong>falco</strong></li>
</ul>
<p>注： 这些工具只预装在 cluster 的工作节点 <strong>node02</strong> 上，不在 master 节点。<br>使用工具至少分析 30 秒 ，使用过滤器检查生成和执行的进程，将事件写到 <strong>&#x2F;opt&#x2F;KSR00101&#x2F;incidents&#x2F;summary</strong> 文件中，<br>其中包含检测的事件， 格式如下： <strong>timestamp,uid&#x2F;username,processName</strong><br>保持工具的原始时间戳格式不变。<br>注： 确保事件文件存储在集群的工作节点上。<br>请注意，考试时，考题里已表明 sysdig 和 falco 在工作节点上，所以你需要 ssh 到开头写的工作节点上。但在模拟环境，你需要 ssh 到 node02 这个工作节点。</p>
<h5 id="1、切换到-node02-的-root-下"><a href="#1、切换到-node02-的-root-下" class="headerlink" title="1、切换到 node02 的 root 下"></a>1、切换到 node02 的 root 下</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh node02</span><br><span class="line">candidate@node02:~$ sudo -i</span><br></pre></td></tr></table></figure>
<h5 id="2、确认题目里所要求-Pod-的唯一标识，比如-ContainerID。"><a href="#2、确认题目里所要求-Pod-的唯一标识，比如-ContainerID。" class="headerlink" title="2、确认题目里所要求 Pod 的唯一标识，比如 ContainerID。"></a>2、确认题目里所要求 Pod 的唯一标识，比如 ContainerID。</h5><p>root@node02:~$ crictl ps | grep redis123</p>
<h5 id="3、编辑-falco-规则-手动输入以下内容，强行背过"><a href="#3、编辑-falco-规则-手动输入以下内容，强行背过" class="headerlink" title="3、编辑 falco 规则 手动输入以下内容，强行背过"></a>3、编辑 falco 规则 手动输入以下内容，强行背过</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@node02:~$ vim /etc/falco/falco_rules.local.yaml</span><br><span class="line">- rule: rule1</span><br><span class="line"> desc: rule1</span><br><span class="line"> condition: container.name = &quot;redis123&quot;</span><br><span class="line"> output: &quot;%evt.time,%user.uid,%proc.name&quot;</span><br><span class="line"> priority: WARNING</span><br><span class="line">root@node02:~$ sudo falco -M 30 -r /etc/falco/falco_rules.local.yaml &gt;&gt; /opt/KSR00101/incidents/summary</span><br><span class="line">root@node02:~$ vim /etc/falco/falco_rules.local.yaml</span><br><span class="line"> output: &quot;%evt.time,%user.name,%proc.name&quot;</span><br><span class="line">root@node02:~$ sudo falco -M 30 -r /etc/falco/falco_rules.local.yaml &gt;&gt; /opt/KSR00101/incidents/summary</span><br></pre></td></tr></table></figure>
<h5 id="4、查看保存的文件"><a href="#4、查看保存的文件" class="headerlink" title="4、查看保存的文件"></a>4、查看保存的文件</h5><p>root@node02:~$ cat &#x2F;opt&#x2F;KSR00101&#x2F;incidents&#x2F;summary<br>exit exit</p>
<h3 id="13、Container-安全上下文"><a href="#13、Container-安全上下文" class="headerlink" title="13、Container 安全上下文"></a>13、Container 安全上下文</h3><p><strong>Context</strong><br>Container Security Context 应在特定 namespace 中修改 Deployment。<br><strong>Task</strong><br>按照如下要求修改 <strong>sec-ns</strong> 命名空间里的 Deployment <strong>secdep</strong><br>一、用 ID 为 <strong>30000</strong> 的用户启动容器（设置用户 ID 为: 30000）<br>二、不允许进程获得超出其父进程的特权（禁止 allowPrivilegeEscalation）<br>三、以只读方式加载容器的根文件系统（对根文件的只读权限）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">搜context 安全上下文</span><br><span class="line">candidate@node01:~$ kubectl -n sec-ns edit deployment secdep</span><br><span class="line">name: sec-ctx-demo-1 / 2</span><br><span class="line">securityContext: #新增或修改 containers 里面第一个 image 的此字段。</span><br><span class="line">  allowPrivilegeEscalation: false</span><br><span class="line">  readOnlyRootFilesystem: true</span><br><span class="line"> </span><br><span class="line">securityContext: #修改模拟环境里的这一行，注意要删除&#123;&#125;。如果考试时没有搜到，则新增这一行。</span><br><span class="line">  runAsUser: 30000</span><br><span class="line">candidate@node01:~$ kubectl -n sec-ns get all</span><br></pre></td></tr></table></figure>
<h3 id="14、TLS-安全配置"><a href="#14、TLS-安全配置" class="headerlink" title="14、TLS 安全配置"></a>14、TLS 安全配置</h3><p><strong>Task</strong><br>通过 TLS 加强 kube-apiserver 安全配置，要求<br>1、kube-apiserver 除了 <strong>TLS 1.3</strong> 及以上的版本可以使用，其他版本都不允许使用。<br>2、密码套件（Cipher suite）为 <strong>TLS_AES_128_GCM_SHA256</strong><br>通过 TLS 加强 ETCD 安全配置，要求 1、密码套件（Cipher suite）为 <strong>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</strong></p>
<h5 id="1-切换到-Master-的-root-下"><a href="#1-切换到-Master-的-root-下" class="headerlink" title="1 切换到 Master 的 root 下"></a>1 切换到 Master 的 root 下</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh master01</span><br><span class="line">candidate@master01:~$ sudo -i</span><br><span class="line">candidate@master01:~$ cp /etc/kubernetes/manifests/kube-apiserver.yaml /tmp</span><br></pre></td></tr></table></figure>
<h5 id="2-修改-kube-apiserver"><a href="#2-修改-kube-apiserver" class="headerlink" title="2 修改 kube-apiserver"></a>2 修改 kube-apiserver</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#搜kube-api server</span><br><span class="line">candidate@master01:~$ vim /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line"> - --tls-cipher-suites=TLS_AES_128_GCM_SHA256</span><br><span class="line"> - --tls-min-version=VersionTLS13 #如果题目要求 TLS 1.2，则就写 VersionTLS12</span><br></pre></td></tr></table></figure>
<h5 id="3-等待-apiserver-自动重启，且恢复正常。"><a href="#3-等待-apiserver-自动重启，且恢复正常。" class="headerlink" title="3 等待 apiserver 自动重启，且恢复正常。"></a>3 等待 apiserver 自动重启，且恢复正常。</h5><p>candidate@master01:~$ kubectl -n kube-system get pod</p>
<h5 id="4-修改-etcd"><a href="#4-修改-etcd" class="headerlink" title="4 修改 etcd"></a>4 修改 etcd</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">candidate@master01:~$ cp /etc/kubernetes/manifests/etcd.yaml /tmp</span><br><span class="line">candidate@master01:~$ vim /etc/kubernetes/manifests/etcd.yaml</span><br><span class="line"> - --cipher-suites=TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</span><br></pre></td></tr></table></figure>
<h5 id="5-等待-etcd-自动重启，且恢复正常。"><a href="#5-等待-etcd-自动重启，且恢复正常。" class="headerlink" title="5 等待 etcd 自动重启，且恢复正常。"></a>5 等待 etcd 自动重启，且恢复正常。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ systemctl daemon-reload</span><br><span class="line">root@master01:~$ systemctl restart kubelet.service</span><br><span class="line">root@master01:~$ kubectl -n kube-system get pod</span><br></pre></td></tr></table></figure>
<p>exit exit</p>
<h3 id="15、启用-API-server-认证"><a href="#15、启用-API-server-认证" class="headerlink" title="15、启用 API server 认证"></a>15、启用 API server 认证</h3><p><strong>Context</strong><br>由 <strong>kubeadm</strong> 创建的 cluster 的 Kubernetes API 服务器，出于测试目的，<br>临时配置允许未经身份验证和未经授权的访问，授予匿名用户 cluster-admin 的访问权限.<br><strong>Task</strong><br>重新配置 cluster 的 Kubernetes APl 服务器，以确保只允许经过身份验证和授权的 REST 请求。<br>使用授权模式 <strong>Node,RBAC</strong> 和准入控制器 <strong>NodeRestriction</strong>。<br>删除用户 <strong>system:anonymous</strong> 的 ClusterRoleBinding 来进行清理。<br>注意：所有 kubectl 配置环境&#x2F;文件也被配置使用未经身份验证和未经授权的访问。<br>你不必更改它，但请注意，一旦完成 cluster 的安全加固， kubectl 的配置将无法工作。<br>您可以使用位于 cluster 的 master 节点上，cluster 原本的 kubectl 配置文件<br>&#x2F;etc&#x2F;kubernetes&#x2F;admin.conf ，以确保经过身份验证的授权的请求仍然被允许。<br>模拟环境里，初始化这道题的脚本为 api.sh</p>
<h5 id="1、切换集群"><a href="#1、切换集群" class="headerlink" title="1、切换集群"></a>1、切换集群</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh master01</span><br><span class="line">candidate@master01:~$ sudo -i</span><br><span class="line">root@master01:~$ sh api.sh</span><br></pre></td></tr></table></figure>
<h5 id="2-确保只有认证并且授权过的-REST-请求才被允许"><a href="#2-确保只有认证并且授权过的-REST-请求才被允许" class="headerlink" title="2 确保只有认证并且授权过的 REST 请求才被允许"></a>2 确保只有认证并且授权过的 REST 请求才被允许</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ mkdir bak15</span><br><span class="line">root@master01:~$ cd bak15</span><br><span class="line">root@master01:~$ cp /etc/kubernetes/manifests/kube-apiserver.yaml .</span><br><span class="line">root@master01:~$ vi /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">修改为</span><br><span class="line"> - --authorization-mode=Node,RBAC </span><br><span class="line"> - --enable-admission-plugins=NodeRestriction </span><br><span class="line"> - --anonymous-auth=false</span><br></pre></td></tr></table></figure>
<h5 id="3-等待-apiserver-自动重启，且恢复正常。-1"><a href="#3-等待-apiserver-自动重启，且恢复正常。-1" class="headerlink" title="3 等待 apiserver 自动重启，且恢复正常。"></a>3 等待 apiserver 自动重启，且恢复正常。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ systemctl daemon-reload</span><br><span class="line">root@master01:~$ systemctl restart kubelet.service</span><br><span class="line">root@master01:~$ kubectl get pod -A</span><br></pre></td></tr></table></figure>
<h5 id="4-删除题目要求的角色绑定"><a href="#4-删除题目要求的角色绑定" class="headerlink" title="4 删除题目要求的角色绑定"></a>4 删除题目要求的角色绑定</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查</span><br><span class="line">root@master01:~$ kubectl get clusterrolebinding system:anonymous</span><br><span class="line"># 删</span><br><span class="line">root@master01:~$ kubectl delete clusterrolebinding system:anonymous</span><br><span class="line"># 再检查</span><br><span class="line">root@master01:~$ kubectl get clusterrolebinding system:anonymous</span><br></pre></td></tr></table></figure>
<p>exit exit</p>
<h3 id="16、ImagePolicyWebhook-容器镜像扫描"><a href="#16、ImagePolicyWebhook-容器镜像扫描" class="headerlink" title="16、ImagePolicyWebhook 容器镜像扫描"></a>16、ImagePolicyWebhook 容器镜像扫描</h3><p><strong>Context</strong><br>cluster 上设置了容器镜像扫描器，但尚未完全集成到 cluster 的配置中。<br>完成后，容器镜像扫描器应扫描并拒绝易受攻击的镜像的使用。<br><strong>Task</strong><br>注意：你必须在 cluster 的 <strong>master</strong> 节点上完成整个考题，所有服务和文件都已被准备好并放置在该节点上。<br>给定一个目录 <strong>&#x2F;etc&#x2F;kubernetes&#x2F;epconfig</strong> 中不完整的配置，<br>以及具有 HTTPS 端点 <a target="_blank" rel="noopener" href="https://image-bouncer-webhook.default.svc:1323/image_policy">https://image-bouncer-webhook.default.svc:1323/image_policy</a> 的功能性容器镜像扫描器： </p>
<ol>
<li>启用必要的插件来创建镜像策略 </li>
<li>校验控制配置并将其更改为隐式拒绝（implicit deny） </li>
<li>编辑配置以正确指向提供的 HTTPS 端点</li>
</ol>
<p>最后，通过尝试部署易受攻击的资源 <strong>&#x2F;cks&#x2F;img&#x2F;web1.yaml</strong> 来测试配置是否有效。<br>模拟环境里，初始化这道题的脚本为 imagePolicy.sh</p>
<h5 id="1、切换到-Master-的-root-下"><a href="#1、切换到-Master-的-root-下" class="headerlink" title="1、切换到 Master 的 root 下"></a>1、切换到 Master 的 root 下</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">candidate@node01:~$ ssh master01</span><br><span class="line">candidate@master01:~$ sudo -i</span><br><span class="line">root@master01:~$ sh imagePolicy.sh</span><br></pre></td></tr></table></figure>
<h5 id="2、编辑-admission-configuration-json-修改-defaultAllow-为-false"><a href="#2、编辑-admission-configuration-json-修改-defaultAllow-为-false" class="headerlink" title="2、编辑 admission_configuration.json 修改 defaultAllow 为 false"></a>2、编辑 admission_configuration.json 修改 defaultAllow 为 false</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ vim /etc/kubernetes/epconfig/admission_configuration.json</span><br><span class="line"> &quot;defaultAllow&quot;: false #将 true 改为 false</span><br></pre></td></tr></table></figure>
<h5 id="3、编辑kubeconfig-yml，添加-webhook-server-地址："><a href="#3、编辑kubeconfig-yml，添加-webhook-server-地址：" class="headerlink" title="3、编辑kubeconfig.yml，添加 webhook server 地址："></a>3、编辑kubeconfig.yml，添加 webhook server 地址：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ vi /etc/kubernetes/epconfig/kubeconfig.yml</span><br><span class="line">- cluster: #下面添加</span><br><span class="line">server: https://image-bouncer-webhook.default.svc:1323/image_policy #添加 webhook server 地址</span><br></pre></td></tr></table></figure>
<h5 id="4、编辑-kube-apiserver-yaml，从官网中引用-ImagePolicyWebhook-的配置信息"><a href="#4、编辑-kube-apiserver-yaml，从官网中引用-ImagePolicyWebhook-的配置信息" class="headerlink" title="4、编辑 kube-apiserver.yaml，从官网中引用 ImagePolicyWebhook 的配置信息"></a>4、编辑 kube-apiserver.yaml，从官网中引用 ImagePolicyWebhook 的配置信息</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ cp /etc/kubernetes/manifests/kube-apiserver.yaml /tmp</span><br><span class="line">root@master01:~$ vi /etc/kubernetes/manifests/kube-apiserver.yaml</span><br><span class="line">#搜imagepolicywebhook</span><br><span class="line"> - --enable-admission-plugins=NodeRestriction,ImagePolicyWebhook</span><br><span class="line"> - --admission-control-config-file=/etc/kubernetes/epconfig/admission_configuration.json</span><br></pre></td></tr></table></figure>
<h5 id="5、等待-apiserver-自动重启，且恢复正常。"><a href="#5、等待-apiserver-自动重启，且恢复正常。" class="headerlink" title="5、等待 apiserver 自动重启，且恢复正常。"></a>5、等待 apiserver 自动重启，且恢复正常。</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@master01:~$ systemctl daemon-reload</span><br><span class="line">root@master01:~$ systemctl restart kubelet.service</span><br><span class="line">root@master01:~$ kubectl -n kube-system get pod</span><br><span class="line">root@master01:~$ kubectl apply -f /cks/img/web1.yaml</span><br><span class="line">不允许创建</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">keli</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/08/12/CKS/">http://example.com/2024/08/12/CKS/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">颗粒的运维手册</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kubernetes%E8%80%83%E8%AF%95/">kubernetes考试</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/12/ClickHouse_start/" title="ClickHouse快速上手"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ClickHouse快速上手</div></div></a></div><div class="next-post pull-right"><a href="/2012/12/21/yueyanglouji/" title="岳阳楼记"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">岳阳楼记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/12/CKA/" title="CKA考试"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-12</div><div class="title">CKA考试</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">keli</div><div class="author-info__description">运维手记</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">练习时长两年半</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81kube-bench-%E4%BF%AE%E5%A4%8D%E4%B8%8D%E5%AE%89%E5%85%A8%E9%A1%B9"><span class="toc-text">1、kube-bench 修复不安全项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Pod-%E6%8C%87%E5%AE%9A-ServiceAccount"><span class="toc-text">2、Pod 指定 ServiceAccount</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA-ServiceAccount"><span class="toc-text">1 创建 ServiceAccount</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA-Pod-%E4%BD%BF%E7%94%A8%E8%AF%A5-ServiceAccount"><span class="toc-text">2 创建 Pod 使用该 ServiceAccount</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%88%A0%E9%99%A4%E6%B2%A1%E6%9C%89%E4%BD%BF%E7%94%A8%E7%9A%84-ServiceAccount"><span class="toc-text">3 删除没有使用的 ServiceAccount</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E7%AD%96%E7%95%A5"><span class="toc-text">3、默认网络策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81RBAC-RoleBinding"><span class="toc-text">4、RBAC - RoleBinding</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%97%A5%E5%BF%97%E5%AE%A1%E8%AE%A1-log-audit"><span class="toc-text">5、日志审计 log audit</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%AE%A1%E8%AE%A1%E7%AD%96%E7%95%A5"><span class="toc-text">配置审计策略</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-master-%E8%8A%82%E7%82%B9%E7%9A%84-kube-apiserver-yaml"><span class="toc-text">配置 master 节点的 kube-apiserver.yaml</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%88%9B%E5%BB%BA-Secret"><span class="toc-text">6、创建 Secret</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%B0%86-db1-test-%E7%9A%84-username-%E5%92%8C-password%EF%BC%8C%E9%80%9A%E8%BF%87-base64-%E8%A7%A3%E7%A0%81%E4%BF%9D%E5%AD%98%E5%88%B0%E9%A2%98%E7%9B%AE%E6%8C%87%E5%AE%9A%E6%96%87%E4%BB%B6%EF%BC%9A"><span class="toc-text">1 将 db1-test 的 username 和 password，通过 base64 解码保存到题目指定文件：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BA-db2-test-%E7%9A%84-secret-%E4%BD%BF%E7%94%A8%E9%A2%98%E7%9B%AE%E8%A6%81%E6%B1%82%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81%E4%BD%9C%E4%B8%BA%E9%94%AE%E5%80%BC%E3%80%82%E6%B3%A8%E6%84%8F%E8%A6%81%E5%8A%A0%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E3%80%82"><span class="toc-text">2 创建名为 db2-test 的 secret 使用题目要求的用户名和密码作为键值。注意要加命名空间。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA-Pod-%E4%BD%BF%E7%94%A8%E8%AF%A5-secret"><span class="toc-text">3 创建 Pod 使用该 secret</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81Dockerfile-%E6%A3%80%E6%B5%8B"><span class="toc-text">7、Dockerfile 检测</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9-Dockerfile"><span class="toc-text">1 修改 Dockerfile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9-deployment-yaml"><span class="toc-text">2 修改 deployment.yaml</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E6%B2%99%E7%AE%B1%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8-gVisor"><span class="toc-text">8、沙箱运行容器 gVisor</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA-RuntimeClass"><span class="toc-text">1 创建 RuntimeClass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%B0%86%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%BA-server-%E4%B8%8B%E7%9A%84-Pod-%E5%BC%95%E7%94%A8-RuntimeClass"><span class="toc-text">2 将命名空间为 server 下的 Pod 引用 RuntimeClass</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E7%BD%91%E7%BB%9C%E7%AD%96%E7%95%A5-NetworkPolicy"><span class="toc-text">9、网络策略 NetworkPolicy</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%A3%80%E6%9F%A5-namespace-%E6%A0%87%E7%AD%BE"><span class="toc-text">1 检查 namespace 标签</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA-NetworkPolicy"><span class="toc-text">2 创建 NetworkPolicy</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81Trivy-%E6%89%AB%E6%8F%8F%E9%95%9C%E5%83%8F%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E"><span class="toc-text">10、Trivy 扫描镜像安全漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%87%E6%8D%A2%E5%88%B0-Master-%E7%9A%84-candidate-%E4%B8%8B"><span class="toc-text">1 切换到 Master 的 candidate 下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4-kamino-%E4%B8%8B%E7%9A%84%E6%89%80%E6%9C%89-pod-%E5%92%8C%E5%85%B6-image-%E7%9A%84%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB"><span class="toc-text">2 获取命名空间 kamino 下的所有 pod 和其 image 的对应关系</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%A3%80%E6%9F%A5%E9%95%9C%E5%83%8F%E6%98%AF%E5%90%A6%E6%9C%89%E9%AB%98%E5%8D%B1%E5%92%8C%E4%B8%A5%E9%87%8D%E7%9A%84%E6%BC%8F%E6%B4%9E"><span class="toc-text">3 检查镜像是否有高危和严重的漏洞</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84-pod"><span class="toc-text">4 删除有问题的 pod</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81AppArmor"><span class="toc-text">11、AppArmor</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%87%E6%8D%A2%E5%88%B0-node02-%E7%9A%84-root-%E4%B8%8B"><span class="toc-text">1 切换到 node02 的 root 下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%88%87%E6%8D%A2%E5%88%B0-apparmor-%E7%9A%84%E7%9B%AE%E5%BD%95"><span class="toc-text">2 切换到 apparmor 的目录</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C-apparmor-%E7%AD%96%E7%95%A5%E6%A8%A1%E5%9D%97"><span class="toc-text">3 执行 apparmor 策略模块</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-pod-%E6%96%87%E4%BB%B6"><span class="toc-text">4 修改 pod 文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81Sysdig-falco"><span class="toc-text">12、Sysdig &amp; falco</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%88%87%E6%8D%A2%E5%88%B0-node02-%E7%9A%84-root-%E4%B8%8B"><span class="toc-text">1、切换到 node02 的 root 下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E7%A1%AE%E8%AE%A4%E9%A2%98%E7%9B%AE%E9%87%8C%E6%89%80%E8%A6%81%E6%B1%82-Pod-%E7%9A%84%E5%94%AF%E4%B8%80%E6%A0%87%E8%AF%86%EF%BC%8C%E6%AF%94%E5%A6%82-ContainerID%E3%80%82"><span class="toc-text">2、确认题目里所要求 Pod 的唯一标识，比如 ContainerID。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E8%BE%91-falco-%E8%A7%84%E5%88%99-%E6%89%8B%E5%8A%A8%E8%BE%93%E5%85%A5%E4%BB%A5%E4%B8%8B%E5%86%85%E5%AE%B9%EF%BC%8C%E5%BC%BA%E8%A1%8C%E8%83%8C%E8%BF%87"><span class="toc-text">3、编辑 falco 规则 手动输入以下内容，强行背过</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E6%9F%A5%E7%9C%8B%E4%BF%9D%E5%AD%98%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-text">4、查看保存的文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81Container-%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-text">13、Container 安全上下文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14%E3%80%81TLS-%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">14、TLS 安全配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%87%E6%8D%A2%E5%88%B0-Master-%E7%9A%84-root-%E4%B8%8B"><span class="toc-text">1 切换到 Master 的 root 下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9-kube-apiserver"><span class="toc-text">2 修改 kube-apiserver</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%AD%89%E5%BE%85-apiserver-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%8C%E4%B8%94%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8%E3%80%82"><span class="toc-text">3 等待 apiserver 自动重启，且恢复正常。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-etcd"><span class="toc-text">4 修改 etcd</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E7%AD%89%E5%BE%85-etcd-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%8C%E4%B8%94%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8%E3%80%82"><span class="toc-text">5 等待 etcd 自动重启，且恢复正常。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15%E3%80%81%E5%90%AF%E7%94%A8-API-server-%E8%AE%A4%E8%AF%81"><span class="toc-text">15、启用 API server 认证</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%88%87%E6%8D%A2%E9%9B%86%E7%BE%A4"><span class="toc-text">1、切换集群</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E7%A1%AE%E4%BF%9D%E5%8F%AA%E6%9C%89%E8%AE%A4%E8%AF%81%E5%B9%B6%E4%B8%94%E6%8E%88%E6%9D%83%E8%BF%87%E7%9A%84-REST-%E8%AF%B7%E6%B1%82%E6%89%8D%E8%A2%AB%E5%85%81%E8%AE%B8"><span class="toc-text">2 确保只有认证并且授权过的 REST 请求才被允许</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%AD%89%E5%BE%85-apiserver-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%8C%E4%B8%94%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8%E3%80%82-1"><span class="toc-text">3 等待 apiserver 自动重启，且恢复正常。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%A0%E9%99%A4%E9%A2%98%E7%9B%AE%E8%A6%81%E6%B1%82%E7%9A%84%E8%A7%92%E8%89%B2%E7%BB%91%E5%AE%9A"><span class="toc-text">4 删除题目要求的角色绑定</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16%E3%80%81ImagePolicyWebhook-%E5%AE%B9%E5%99%A8%E9%95%9C%E5%83%8F%E6%89%AB%E6%8F%8F"><span class="toc-text">16、ImagePolicyWebhook 容器镜像扫描</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%88%87%E6%8D%A2%E5%88%B0-Master-%E7%9A%84-root-%E4%B8%8B"><span class="toc-text">1、切换到 Master 的 root 下</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E8%BE%91-admission-configuration-json-%E4%BF%AE%E6%94%B9-defaultAllow-%E4%B8%BA-false"><span class="toc-text">2、编辑 admission_configuration.json 修改 defaultAllow 为 false</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81%E7%BC%96%E8%BE%91kubeconfig-yml%EF%BC%8C%E6%B7%BB%E5%8A%A0-webhook-server-%E5%9C%B0%E5%9D%80%EF%BC%9A"><span class="toc-text">3、编辑kubeconfig.yml，添加 webhook server 地址：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%E3%80%81%E7%BC%96%E8%BE%91-kube-apiserver-yaml%EF%BC%8C%E4%BB%8E%E5%AE%98%E7%BD%91%E4%B8%AD%E5%BC%95%E7%94%A8-ImagePolicyWebhook-%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-text">4、编辑 kube-apiserver.yaml，从官网中引用 ImagePolicyWebhook 的配置信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5%E3%80%81%E7%AD%89%E5%BE%85-apiserver-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF%EF%BC%8C%E4%B8%94%E6%81%A2%E5%A4%8D%E6%AD%A3%E5%B8%B8%E3%80%82"><span class="toc-text">5、等待 apiserver 自动重启，且恢复正常。</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/MySQL_install/" title="MySQL 8.0的三种安装方式">MySQL 8.0的三种安装方式</a><time datetime="2024-08-12T02:26:28.014Z" title="发表于 2024-08-12 10:26:28">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/superset_install/" title="superset部署与实践">superset部署与实践</a><time datetime="2024-08-12T02:26:28.014Z" title="发表于 2024-08-12 10:26:28">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/python_50/" title="python编程50例">python编程50例</a><time datetime="2024-08-12T02:26:28.014Z" title="发表于 2024-08-12 10:26:28">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/superset_pk_metabase/" title="superset与metabase调研比较">superset与metabase调研比较</a><time datetime="2024-08-12T02:26:28.014Z" title="发表于 2024-08-12 10:26:28">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/python_spider_new/" title="Python实时爬虫：自动抓取并推送学校最新通知">Python实时爬虫：自动抓取并推送学校最新通知</a><time datetime="2024-08-12T02:26:28.014Z" title="发表于 2024-08-12 10:26:28">2024-08-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By keli</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>