<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密码生成器</title>
    <style>
        :root {
            --bg: #f5f5f7;
            --card-bg: #ffffff;
            --text: #1d1d1f;
            --text-secondary: #86868b;
            --accent: #007aff;
            --accent-light: #e8f2ff;
            --success: #34c759;
            --warning: #ff9500;
            --danger: #ff3b30;
            --border: rgba(0, 0, 0, 0.08);
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.08);
            --radius-sm: 12px;
            --radius-md: 20px;
            --radius-lg: 28px;
            --font-body: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Segoe UI', Roboto, sans-serif;
            --font-mono: 'SF Mono', 'JetBrains Mono', 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
        }

        .nav-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px 24px;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            transition: color 0.2s;
        }

        .nav-link:hover { color: var(--accent); }

        .container {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 32px;
            box-shadow: var(--shadow-lg), 0 0 0 1px rgba(0, 0, 0, 0.04);
            max-width: 480px;
            width: 100%;
        }

        h1 {
            text-align: center;
            font-family: var(--font-body);
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 28px;
            color: var(--text);
        }

        .password-display {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 18px;
            margin-bottom: 20px;
            position: relative;
        }

        #password {
            font-family: var(--font-mono);
            font-size: 16px;
            color: var(--text);
            word-break: break-all;
            min-height: 24px;
            padding-right: 70px;
        }

        .copy-btn {
            position: absolute;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            background: var(--accent);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .copy-btn:hover {
            background: #0056b3;
        }

        .copy-btn.copied {
            background: var(--success);
        }

        .strength-meter {
            margin-bottom: 24px;
        }

        .strength-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        #strength-text {
            font-weight: 600;
            color: var(--text);
        }

        .strength-bar {
            height: 6px;
            background: var(--bg);
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            transition: all 0.4s ease;
        }

        .strength-fill.weak { background: var(--danger); width: 25%; }
        .strength-fill.fair { background: var(--warning); width: 50%; }
        .strength-fill.good { background: #007aff; width: 75%; }
        .strength-fill.strong { background: var(--success); width: 100%; }

        .length-section {
            margin-bottom: 24px;
        }

        .length-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .length-header label {
            font-weight: 500;
            color: var(--text);
            font-size: 0.95rem;
        }

        #length-value {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            min-width: 40px;
            text-align: right;
        }

        #length {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: var(--bg);
            border-radius: 3px;
            outline: none;
            border: 1px solid var(--border);
        }

        #length::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--card-bg);
            border: 2px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transition: all 0.2s ease;
        }

        #length::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 10px rgba(0, 122, 255, 0.3);
        }

        #length::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: var(--card-bg);
            border: 2px solid var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 24px;
        }

        .option {
            display: flex;
            align-items: center;
            padding: 12px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .option input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: var(--accent);
        }

        .option label {
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text);
            white-space: nowrap;
        }

        .generate-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        .generate-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.4);
        }

        .generate-btn:active {
            transform: translateY(0);
        }

        .history {
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .history h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .clear-history {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.8rem;
            transition: color 0.2s;
        }

        .clear-history:hover {
            color: var(--danger);
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 120px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 14px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            font-family: var(--font-mono);
            font-size: 0.8rem;
            border: 1px solid var(--border);
        }

        .history-item span:first-child {
            color: var(--text);
            word-break: break-all;
            margin-right: 10px;
        }

        .history-item span:last-child {
            color: var(--text-secondary);
            font-size: 0.7rem;
            white-space: nowrap;
        }

        @media (max-width: 420px) {
            .container {
                padding: 24px 20px;
            }

            .options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav class="nav-header">
        <a href="/index.html" class="nav-link">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            返回首页
        </a>
    </nav>

    <div class="container">
        <h1>密码生成器</h1>

        <div class="password-display">
            <div id="password">点击生成按钮创建密码</div>
            <button class="copy-btn" onclick="copyPassword()">复制</button>
        </div>

        <div class="strength-meter">
            <div class="strength-label">
                <span>密码强度</span>
                <span id="strength-text">-</span>
            </div>
            <div class="strength-bar">
                <div class="strength-fill" id="strength-fill"></div>
            </div>
        </div>

        <div class="length-section">
            <div class="length-header">
                <label>密码长度</label>
                <span id="length-value">16</span>
            </div>
            <input type="range" id="length" min="8" max="64" value="16">
        </div>

        <div class="options">
            <div class="option">
                <input type="checkbox" id="uppercase" checked>
                <label for="uppercase">大写字母</label>
            </div>
            <div class="option">
                <input type="checkbox" id="lowercase" checked>
                <label for="lowercase">小写字母</label>
            </div>
            <div class="option">
                <input type="checkbox" id="numbers" checked>
                <label for="numbers">数字</label>
            </div>
            <div class="option">
                <input type="checkbox" id="symbols" checked>
                <label for="symbols">特殊符号</label>
            </div>
            <div class="option">
                <input type="checkbox" id="ambiguous">
                <label for="ambiguous">排除易混淆</label>
            </div>
            <div class="option">
                <input type="checkbox" id="memorable">
                <label for="memorable">易记密码</label>
            </div>
        </div>

        <button class="generate-btn" onclick="generatePassword()">生成密码</button>

        <div class="history">
            <div class="history-header">
                <h3>生成历史</h3>
                <button class="clear-history" onclick="clearHistory()">清空</button>
            </div>
            <div class="history-list" id="history-list"></div>
        </div>
    </div>

    <script>
        const lengthSlider = document.getElementById('length');
        const lengthValue = document.getElementById('length-value');
        const passwordDisplay = document.getElementById('password');
        const strengthText = document.getElementById('strength-text');
        const strengthFill = document.getElementById('strength-fill');
        const historyList = document.getElementById('history-list');

        let passwordHistory = JSON.parse(localStorage.getItem('passwordHistory') || '[]');

        lengthSlider.addEventListener('input', () => {
            lengthValue.textContent = lengthSlider.value;
        });

        function getCharSets() {
            return {
                uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                lowercase: 'abcdefghijklmnopqrstuvwxyz',
                numbers: '0123456789',
                symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?',
                ambiguous: '0O1lI|',
                memorable: ''
            };
        }

        function generateMemorablePassword(length) {
            const adjectives = ['happy', 'bright', 'swift', 'clever', 'brave', 'calm', 'eager', 'fair', 'kind', 'lucky'];
            const nouns = ['river', 'mountain', 'ocean', 'forest', 'eagle', 'tiger', 'dragon', 'phoenix', 'lion', 'wolf'];
            const separators = ['-', '_', '.', '#', '@', '$', '%'];
            const specials = ['!', '@', '#', '$', '%', '&', '*'];

            let password = '';
            const adj = adjectives[Math.floor(Math.random() * adjectives.length)];
            const noun = nouns[Math.floor(Math.random() * nouns.length)];
            const sep = separators[Math.floor(Math.random() * separators.length)];
            const special = specials[Math.floor(Math.random() * specials.length)];
            const num = Math.floor(Math.random() * 100);

            password = adj + sep + noun + num + special;

            while (password.length < length) {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
                password += chars[Math.floor(Math.random() * chars.length)];
            }

            return password.slice(0, length);
        }

        function calculateEntropy(password) {
            let charsetSize = 0;
            if (/[a-z]/.test(password)) charsetSize += 26;
            if (/[A-Z]/.test(password)) charsetSize += 26;
            if (/[0-9]/.test(password)) charsetSize += 10;
            if (/[^a-zA-Z0-9]/.test(password)) charsetSize += 32;

            const entropy = password.length * Math.log2(charsetSize);
            return entropy;
        }

        function getStrengthLevel(entropy) {
            if (entropy < 40) return { level: 'weak', text: '弱', className: 'weak' };
            if (entropy < 60) return { level: 'fair', text: '一般', className: 'fair' };
            if (entropy < 80) return { level: 'good', text: '良好', className: 'good' };
            return { level: 'strong', text: '强', className: 'strong' };
        }

        function updateStrengthMeter(password) {
            const entropy = calculateEntropy(password);
            const { level, text, className } = getStrengthLevel(entropy);

            strengthText.textContent = text;
            strengthFill.className = 'strength-fill ' + className;
        }

        function generatePassword() {
            const length = parseInt(lengthSlider.value);
            const useUppercase = document.getElementById('uppercase').checked;
            const useLowercase = document.getElementById('lowercase').checked;
            const useNumbers = document.getElementById('numbers').checked;
            const useSymbols = document.getElementById('symbols').checked;
            const excludeAmbiguous = document.getElementById('ambiguous').checked;
            const useMemorable = document.getElementById('memorable').checked;

            if (useMemorable) {
                const password = generateMemorablePassword(length);
                passwordDisplay.textContent = password;
                updateStrengthMeter(password);
                addToHistory(password);
                return;
            }

            let charset = '';
            let requiredChars = [];

            if (useUppercase) {
                let upper = getCharSets().uppercase;
                if (excludeAmbiguous) upper = upper.replace(/[IO]/g, '');
                charset += upper;
                requiredChars.push(upper[Math.floor(Math.random() * upper.length)]);
            }

            if (useLowercase) {
                let lower = getCharSets().lowercase;
                if (excludeAmbiguous) lower = lower.replace(/[l]/g, '');
                charset += lower;
                requiredChars.push(lower[Math.floor(Math.random() * lower.length)]);
            }

            if (useNumbers) {
                let nums = getCharSets().numbers;
                if (excludeAmbiguous) nums = nums.replace(/[01]/g, '');
                charset += nums;
                requiredChars.push(nums[Math.floor(Math.random() * nums.length)]);
            }

            if (useSymbols) {
                charset += getCharSets().symbols;
                requiredChars.push(getCharSets().symbols[Math.floor(Math.random() * getCharSets().symbols.length)]);
            }

            if (charset === '') {
                passwordDisplay.textContent = '请至少选择一个字符类型';
                return;
            }

            let password = [...requiredChars];

            for (let i = password.length; i < length; i++) {
                password.push(charset[Math.floor(Math.random() * charset.length)]);
            }

            for (let i = password.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [password[i], password[j]] = [password[j], password[i]];
            }

            const finalPassword = password.join('');
            passwordDisplay.textContent = finalPassword;
            updateStrengthMeter(finalPassword);
            addToHistory(finalPassword);
        }

        function addToHistory(password) {
            const timestamp = new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            passwordHistory.unshift({ password, timestamp });
            passwordHistory = passwordHistory.slice(0, 10);
            localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
            renderHistory();
        }

        function renderHistory() {
            if (passwordHistory.length === 0) {
                historyList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 10px; font-size: 0.85rem;">暂无记录</div>';
                return;
            }
            historyList.innerHTML = passwordHistory.map(item => `
                <div class="history-item">
                    <span>${item.password}</span>
                    <span>${item.timestamp}</span>
                </div>
            `).join('');
        }

        function clearHistory() {
            passwordHistory = [];
            localStorage.removeItem('passwordHistory');
            renderHistory();
        }

        async function copyPassword() {
            const password = passwordDisplay.textContent;
            if (!password || password === '点击生成按钮创建密码') return;

            const btn = document.querySelector('.copy-btn');
            btn.textContent = '复制中...';

            try {
                await navigator.clipboard.writeText(password);
                btn.textContent = '已复制';
                btn.classList.add('copied');
            } catch (err) {
                // 备用方案
                const textArea = document.createElement('textarea');
                textArea.value = password;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                btn.textContent = '已复制';
                btn.classList.add('copied');
            }

            setTimeout(() => {
                btn.textContent = '复制';
                btn.classList.remove('copied');
            }, 2000);
        }

        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                generatePassword();
            }
        });

        renderHistory();
        generatePassword();
    </script>
</body>
</html>
